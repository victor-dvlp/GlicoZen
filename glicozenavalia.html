<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GlicoZen | Autoavaliação de Glicose</title>
    <!-- Carrega o Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configuração personalizada do Tailwind para fonte Inter -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* light blue/gray background */
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        main {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem 0;
        }
    </style>
</head>
<body>

    <!-- 1. Header & Navigation -->
    <header class="bg-white shadow-sm sticky top-0 z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-start items-center">
            <!-- Logo -->
            <div class="text-3xl font-extrabold text-indigo-600 tracking-tight">
                GlicoZen Avalia
            </div>
        </div>
    </header>

    <main>
        <!-- Container principal do quiz/aplicativo -->
        <div id="app-container" class="w-full max-w-lg mx-4 bg-white p-8 md:p-10 rounded-xl shadow-2xl border-t-8 border-indigo-500">
            <!-- O conteúdo do quiz será injetado aqui pelo JavaScript -->
            <h1 class="text-3xl font-bold text-gray-900 mb-6 text-center">Inicie sua Autoavaliação Zen</h1>
            <p class="text-gray-600 text-center mb-8">Responda a algumas perguntas simples para obter um resumo rápido da sua condição.</p>
            
            <div id="quiz-content">
                <!-- Conteúdo dinâmico -->
            </div>
            
            <div id="navigation-buttons" class="mt-8 flex justify-between">
                <!-- Botões dinâmicos (Voltar/Próximo/Finalizar) -->
            </div>
            
        </div>
    </main>

    <!-- 6. Footer (Manteve o design) -->
    <footer class="bg-gray-800 text-white py-6 mt-auto">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p class="text-sm text-gray-400">© 2025 GlicoZen. Simplificando o controle de diabetes. (Esta é uma simulação de avaliação).</p>
        </div>
    </footer>

    <!-- JavaScript para o Quiz Interativo -->
    <script>
        // Variáveis de Estado
        let currentStepIndex = 0;
        const quizData = {};
        
        // Elementos DOM
        const quizContentEl = document.getElementById('quiz-content');
        const navButtonsEl = document.getElementById('navigation-buttons');
        const appContainerEl = document.getElementById('app-container');

        // Estrutura do Quiz
        const quizSteps = [
            {
                id: 'glicose',
                title: 'Qual foi sua última medição de glicose?',
                type: 'number',
                placeholder: 'Ex: 125',
                unit: 'mg/dL',
                key: 'glicose',
                min: 1,
                error: 'Por favor, insira um valor de glicose válido (acima de 0).'
            },
            {
                id: 'estado',
                title: 'Em qual estado essa leitura foi feita?',
                type: 'options',
                key: 'estado',
                options: [
                    { value: 'fasting', label: 'Em Jejum (8h+ sem comer)' },
                    { value: 'post_prandial', label: 'Pós-prandial (2h após a refeição)' },
                    { value: 'random', label: 'Aleatório (Outro momento)' }
                ],
                error: 'Por favor, selecione um estado.'
            },
            {
                id: 'atividade',
                title: 'Qual foi seu nível de atividade física hoje?',
                type: 'options',
                key: 'atividade',
                options: [
                    { value: 'low', label: 'Baixa (Sentado, pouco movimento)' },
                    { value: 'medium', label: 'Média (Caminhada leve, tarefas domésticas)' },
                    { value: 'high', label: 'Alta (Exercício vigoroso, corrida)' }
                ],
                error: 'Por favor, selecione um nível de atividade.'
            }
        ];

        /**
         * Gera o HTML para o passo atual do quiz.
         * @param {Object} step O objeto de passo do quiz.
         */
        function renderStep(step) {
            appContainerEl.querySelector('h1').textContent = step.title;
            appContainerEl.querySelector('p').textContent = `Passo ${currentStepIndex + 1} de ${quizSteps.length}`;
            quizContentEl.innerHTML = '';
            navButtonsEl.innerHTML = '';
            
            let inputHtml = '';
            
            // Renderiza inputs baseados no tipo (number ou options)
            if (step.type === 'number') {
                inputHtml = `
                    <div class="relative mt-4">
                        <input type="number" id="${step.id}" name="${step.key}" 
                            class="w-full p-4 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:ring-indigo-500 text-2xl font-semibold transition duration-200"
                            placeholder="${step.placeholder}" min="${step.min}" value="${quizData[step.key] || ''}">
                        <span class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-500 text-lg">${step.unit}</span>
                    </div>
                `;
            } else if (step.type === 'options') {
                inputHtml = step.options.map(option => `
                    <label class="block cursor-pointer p-4 mb-3 border-2 border-gray-200 rounded-xl transition duration-200 hover:bg-indigo-50 hover:border-indigo-400">
                        <input type="radio" name="${step.key}" value="${option.value}" class="mr-3 text-indigo-600 focus:ring-indigo-500" 
                            ${quizData[step.key] === option.value ? 'checked' : ''}>
                        <span class="text-gray-800 font-medium">${option.label}</span>
                    </label>
                `).join('');
            }

            quizContentEl.innerHTML = inputHtml;
            quizContentEl.innerHTML += `<p id="error-message" class="text-red-500 text-sm mt-3 hidden">${step.error}</p>`;


            // Botões de Navegação
            if (currentStepIndex > 0) {
                navButtonsEl.innerHTML += `
                    <button id="back-button" class="py-3 px-6 bg-gray-200 text-gray-800 font-semibold rounded-full hover:bg-gray-300 transition duration-300">
                        Voltar
                    </button>
                `;
            } else {
                 // Espaçamento para manter o botão "Próximo" no lado direito, mesmo no primeiro passo
                navButtonsEl.innerHTML += `<div></div>`; 
            }

            const nextButtonText = currentStepIndex === quizSteps.length - 1 ? 'Finalizar e Gerar Relatório' : 'Próximo';
            navButtonsEl.innerHTML += `
                <button id="next-button" class="py-3 px-8 bg-indigo-600 text-white font-bold rounded-full shadow-lg hover:bg-indigo-700 transition duration-300 transform hover:scale-105">
                    ${nextButtonText}
                </button>
            `;

            // Adiciona Listeners
            document.getElementById('next-button').addEventListener('click', handleNext);
            if (currentStepIndex > 0) {
                document.getElementById('back-button').addEventListener('click', handleBack);
            }
        }

        /**
         * Valida e avança para o próximo passo ou finaliza.
         */
        function handleNext() {
            const step = quizSteps[currentStepIndex];
            const errorEl = document.getElementById('error-message');
            let value;

            // 1. Captura e Validação
            if (step.type === 'number') {
                const inputEl = document.getElementById(step.id);
                value = parseFloat(inputEl.value);
                if (isNaN(value) || value <= 0) {
                    errorEl.textContent = step.error;
                    errorEl.classList.remove('hidden');
                    return;
                }
            } else if (step.type === 'options') {
                const checkedRadio = document.querySelector(`input[name="${step.key}"]:checked`);
                if (!checkedRadio) {
                    errorEl.textContent = step.error;
                    errorEl.classList.remove('hidden');
                    return;
                }
                value = checkedRadio.value;
            }

            // Esconde erro se a validação passar
            errorEl.classList.add('hidden');
            
            // 2. Armazena o dado
            quizData[step.key] = value;

            // 3. Navegação
            if (currentStepIndex < quizSteps.length - 1) {
                currentStepIndex++;
                renderStep(quizSteps[currentStepIndex]);
            } else {
                showReport();
            }
        }

        /**
         * Volta para o passo anterior.
         */
        function handleBack() {
            if (currentStepIndex > 0) {
                currentStepIndex--;
                renderStep(quizSteps[currentStepIndex]);
            }
        }

        /**
         * Gera o relatório final baseado nos dados coletados.
         */
        function showReport() {
            // As linhas problemáticas que tentavam manipular H1 e P após limpar o innerHTML foram removidas.
            
            const { glicose, estado, atividade } = quizData;
            let analiseTitle = '';
            let analiseText = '';
            let analiseColor = 'text-green-600'; // Padrão para "Ótimo"

            // Lógica de Análise Simples
            if (estado === 'fasting') {
                if (glicose >= 70 && glicose <= 100) {
                    analiseTitle = 'Excelente Controle em Jejum.';
                    analiseText = 'Seus níveis de glicose em jejum estão na faixa ideal para a maioria das pessoas. Continue com a consistência!';
                } else if (glicose > 100 && glicose <= 125) {
                    analiseTitle = 'Atenção Necessária (Pré-diabetes).';
                    analiseText = 'Seus níveis estão ligeiramente elevados em jejum. Monitore de perto e converse com seu médico sobre ajustes na dieta ou exercícios.';
                    analiseColor = 'text-yellow-600';
                } else if (glicose < 70) {
                    analiseTitle = 'Hipoglicemia em Jejum.';
                    analiseText = 'Seu nível está baixo. Verifique se há sintomas. Lembre-se de sempre ter uma fonte rápida de carboidrato por perto e ajuste as doses de insulina se for o caso, sob orientação médica.';
                    analiseColor = 'text-red-600';
                } else {
                    analiseTitle = 'Glicemia Elevada em Jejum.';
                    analiseText = 'Seu nível está alto, indicando que pode ser necessário um ajuste no seu tratamento noturno. Consulte seu médico imediatamente.';
                    analiseColor = 'text-red-600';
                }
            } else if (estado === 'post_prandial') {
                if (glicose < 180) {
                    analiseTitle = 'Bom Controle Pós-Prandial.';
                    analiseText = 'Seus níveis estão bem controlados após a refeição. Isso sugere um bom manejo de carboidratos e doses de insulina (se aplicável).';
                } else {
                    analiseTitle = 'Glicemia Alta Pós-Prandial.';
                    analiseText = 'Seus níveis estão elevados após a refeição. Revise a contagem de carboidratos da sua última refeição e, se necessário, converse com seu médico sobre a dose de insulina rápida.';
                    analiseColor = 'text-red-600';
                }
            } else { // random
                if (glicose < 180) {
                    analiseTitle = 'Nível Aleatório Controlado.';
                    analiseText = 'Seus níveis aleatórios estão saudáveis. Siga monitorando para garantir a consistência ao longo do dia.';
                } else {
                    analiseTitle = 'Nível Elevado (Aleatório).';
                    analiseText = 'O nível está alto para uma leitura aleatória. Tente identificar o que pode ter causado este pico (refeição, estresse, doença).';
                    analiseColor = 'text-yellow-600';
                }
            }

            // Conteúdo do Relatório - O innerHTML é definido apenas uma vez, substituindo o quiz.
            appContainerEl.innerHTML = `
                <h2 class="text-4xl font-extrabold text-center text-gray-900 mb-2">Seu Relatório GlicoZen</h2>
                <h3 class="text-3xl font-bold text-center ${analiseColor} mb-6">${analiseTitle}</h3>
                <div class="space-y-4">
                    <p class="text-xl text-gray-700">${analiseText}</p>
                    
                    <div class="bg-indigo-50 p-6 rounded-xl shadow-inner mt-6">
                        <h4 class="text-lg font-bold text-indigo-800 mb-3">Seus Dados</h4>
                        <p class="text-gray-700"><strong>Glicose:</strong> <span class="font-bold text-indigo-600">${glicose} mg/dL</span></p>
                        <p class="text-gray-700"><strong>Estado:</strong> ${quizSteps[1].options.find(opt => opt.value === estado).label}</p>
                        <p class="text-gray-700"><strong>Atividade:</strong> ${quizSteps[2].options.find(opt => opt.value === atividade).label}</p>
                    </div>

                    <div class="pt-6 border-t mt-6">
                        <h4 class="text-2xl font-bold text-gray-900 mb-2">Próximos Passos GlicoZen</h4>
                        <ul class="list-disc list-inside text-gray-700 space-y-2">
                            <li>Lembre-se: esta é uma análise preliminar. Sempre consulte seu médico ou nutricionista para decisões de tratamento.</li>
                            <li>Use o GlicoZen para registrar estes dados diariamente e observar tendências.</li>
                            <li>Um monitoramento consistente é a chave para a autonomia no tratamento do diabetes.</li>
                        </ul>
                    </div>
                </div>
                
                <div class="mt-10 text-center">
                    <a href="./obterApp.html" class="inline-block py-3 px-8 bg-indigo-600 text-white font-bold rounded-full shadow-lg hover:bg-indigo-700 transition duration-300 transform hover:scale-105 no-underline">
            Tenha seu Dashboard Personalizado
        </a>
                </div>
            `;
        }
        

        // Inicia a aplicação no carregamento da página
        document.addEventListener('DOMContentLoaded', () => {
            // Assegura que a lógica de smooth scrolling não interfira com o quiz
            // e renderiza o primeiro passo
            renderStep(quizSteps[currentStepIndex]);
        });

    </script>
</body>
</html>